# name: Upload to Blob on Approve Comment

# on:
#   issue_comment:
#     types: [created]

# permissions:
#   contents: read
#   issues: write

# jobs:
#   upload-to-blob:
#     # Only run if comment is "/approve" and on issues (not PRs)
#     if: |
#       github.event.comment.body == '/approve' &&
#       !github.event.issue.pull_request
#     runs-on: ubuntu-latest
    
#     steps:
#       - name: Checkout repository
#         uses: actions/checkout@v4

#       - name: Setup Node.js
#         uses: actions/setup-node@v4
#         with:
#           node-version: '20'
#           cache: 'npm'

#       - name: Install dependencies
#         run: npm ci

#       - name: Check for blob-data directory
#         id: check-dir
#         run: |
#           if [ -d "blob-data" ] && [ "$(ls -A blob-data/*.json 2>/dev/null)" ]; then
#             echo "has_files=true" >> $GITHUB_OUTPUT
#             echo "✅ Found JSON files in blob-data/"
#           else
#             echo "has_files=false" >> $GITHUB_OUTPUT
#             echo "❌ No JSON files found in blob-data/"
#           fi

#       - name: Upload to Vercel Blob
#         if: steps.check-dir.outputs.has_files == 'true'
#         env:
#           BLOB_READ_WRITE_TOKEN: ${{ secrets.BLOB_READ_WRITE_TOKEN }}
#         run: |
#           if [ -z "$BLOB_READ_WRITE_TOKEN" ]; then
#             echo "❌ BLOB_READ_WRITE_TOKEN secret not configured"
#             exit 1
#           fi
#           npm run upload-to-blob

#       - name: Add success comment
#         if: success() && steps.check-dir.outputs.has_files == 'true'
#         uses: actions/github-script@v7
#         with:
#           script: |
#             const comment = `✅ Successfully uploaded JSON files to Vercel Blob Storage!\n\n` +
#                           `Files from \`blob-data/\` directory have been uploaded.\n\n` +
#                           `**Next steps:**\n` +
#                           `1. Check Vercel dashboard: https://vercel.com/storage\n` +
#                           `2. Verify your blob storage URL\n` +
#                           `3. Update environment variables if needed`;
            
#             github.rest.issues.createComment({
#               issue_number: context.issue.number,
#               owner: context.repo.owner,
#               repo: context.repo.repo,
#               body: comment
#             });

#       - name: Add no files comment
#         if: steps.check-dir.outputs.has_files == 'false'
#         uses: actions/github-script@v7
#         with:
#           script: |
#             const comment = `❌ No JSON files found in \`blob-data/\` directory.\n\n` +
#                           `Please generate JSON files first by creating an issue with:\n` +
#                           `- \`generate json for recent X song\`\n` +
#                           `- \`generate json for category CategoryName\``;
            
#             github.rest.issues.createComment({
#               issue_number: context.issue.number,
#               owner: context.repo.owner,
#               repo: context.repo.repo,
#               body: comment
#             });

#       - name: Add error comment
#         if: failure()
#         uses: actions/github-script@v7
#         with:
#           script: |
#             const comment = `❌ Failed to upload files to Vercel Blob Storage.\n\n` +
#                           `Please check the workflow logs for details.\n\n` +
#                           `Common issues:\n` +
#                           `- \`BLOB_READ_WRITE_TOKEN\` secret not configured\n` +
#                           `- Network issues with Vercel Blob API\n` +
#                           `- Invalid JSON files in blob-data/`;
            
#             github.rest.issues.createComment({
#               issue_number: context.issue.number,
#               owner: context.repo.owner,
#               repo: context.repo.repo,
#               body: comment
#             });
